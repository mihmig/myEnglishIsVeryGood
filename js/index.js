var answers = {
    'm1vAtA' : {
        'm1vAtAq01': '6',
        'm1vAtAq02': '4',
        'm1vAtAq03': '2',
        'm1vAtAq04': '10',
        'm1vAtAq05': '8',
        'm1vAtAq06': '9',
        'm1vAtAq07': '7',
        'm1vAtAq08': '5'
    },
    'm1vAtB' : {
        'm1vAtBq01': '5',
        'm1vAtBq02': '1',
        'm1vAtBq03': '7',
        'm1vAtBq04': '4',
        'm1vAtBq05': '9',
        'm1vAtBq06': '6',
        'm1vAtBq07': '8'
    },
    'm1vAtC' : {
        'm1vAtCq01': '2',
        'm1vAtCq02': '2',
        'm1vAtCq03': '1',
        'm1vAtCq04': '2',
        'm1vAtCq05': '2',
        'm1vAtCq06': '2',
        'm1vAtCq07': '1',
        'm1vAtCq08': '2',
        'm1vAtCq09': '1',
        'm1vAtCq10': '1',
    },
    'm1vAtD': {
        'm1vAtDq01': 'rarely left',
        'm1vAtDq02': 'did you take',
        'm1vAtDq03': 'was watering',
        'm1vAtDq04': 'didnt meet',
        'm1vAtDq05': 'was listening'
    },
    'm1vAtE': {
        'm1vAtEq01': 'the most sociable',
        'm1vAtEq02': 'more sensitive',
        'm1vAtEq03': 'the most patient',
        'm1vAtEq04': 'the least',
        'm1vAtEq05': 'older'
    },
    'm1vAtF': {
        'm1vAtFq01': '5',
        'm1vAtFq02': '3',
        'm1vAtFq03': '2',
        'm1vAtFq04': '1',
        'm1vAtFq05': '4'
    },
    'm1vAtG': {
        'm1vAtGq01': '1',
        'm1vAtGq02': '2',
        'm1vAtGq03': '1',
        'm1vAtGq04': '1',
        'm1vAtGq05': '2'
    },
    'm1vAtH': {
        'm1vAtHq01': '3',
        'm1vAtHq02': '6',
        'm1vAtHq03': '1',
        'm1vAtHq04': '5',
        'm1vAtHq05': '4'
    },
    'm1vBtA' : {
        'm1vBtAq01': '2',
        'm1vBtAq02': '8',
        'm1vBtAq03': '3',
        'm1vBtAq04': '6',
        'm1vBtAq05': '4',
        'm1vBtAq06': '5',
        'm1vBtAq07': '9',
        'm1vBtAq08': '7'
    },
    'm1vBtB' : {
        'm1vBtBq01': '6',
        'm1vBtBq02': '7',
        'm1vBtBq03': '10',
        'm1vBtBq04': '4',
        'm1vBtBq05': '8',
        'm1vBtBq06': '2',
        'm1vBtBq07': '5'
    },
    'm1vBtC' : {
        'm1vBtCq01': '1',
        'm1vBtCq02': '1',
        'm1vBtCq03': '2',
        'm1vBtCq04': '1',
        'm1vBtCq05': '2',
        'm1vBtCq06': '2',
        'm1vBtCq07': '2',
        'm1vBtCq08': '1',
        'm1vBtCq09': '2',
        'm1vBtCq10': '2',
    },
    'm1vBtD': {
        'm1vBtDq01': 'didnt meet',
        'm1vBtDq02': 'were you doing',
        'm1vBtDq03': 'was listening',
        'm1vBtDq04': 'left',
        'm1vBtDq05': 'did you start'
    },
    'm1vBtE': {
        'm1vBtEq01': 'the most selfish',
        'm1vBtEq02': 'duller',
        'm1vBtEq03': 'the least',
        'm1vBtEq04': 'more',
        'm1vBtEq05': 'better'
    },
    'm1vBtF': {
        'm1vBtFq01': '4',
        'm1vBtFq02': '5',
        'm1vBtFq03': '1',
        'm1vBtFq04': '2',
        'm1vBtFq05': '3'
    },
    'm1vBtG': {
        'm1vBtGq01': '1',
        'm1vBtGq02': '2',
        'm1vBtGq03': '1',
        'm1vBtGq04': '2',
        'm1vBtGq05': '1'
    },
    'm1vBtH': {
        'm1vBtHq01': '6',
        'm1vBtHq02': '4',
        'm1vBtHq03': '5',
        'm1vBtHq04': '1',
        'm1vBtHq05': '3'
    },'m2vAtA' : {
        'm2vAtAq01': '2',
        'm2vAtAq02': '2',
        'm2vAtAq03': '1',
        'm2vAtAq04': '2',
        'm2vAtAq05': '1',
        'm2vAtAq06': '1',
        'm2vAtAq07': '2',
        'm2vAtAq08': '1',
        'm2vAtAq09': '2',
        'm2vAtAq10': '1'
    },
    'm2vAtB' : {
        'm2vAtBq01': '3',
        'm2vAtBq02': '5',
        'm2vAtBq03': '7',
        'm2vAtBq04': '4',
        'm2vAtBq05': '1'
    },
    'm2vAtC' : {
        'm2vAtCq01': 'havent bought',
        'm2vAtCq02': 'have you been writing',
        'm2vAtCq03': 'has gone',
        'm2vAtCq04': 'have you ever eaten',
        'm2vAtCq05': 'has been working',
    },
    'm2vAtD': {
        'm2vAtDq01': '1',
        'm2vAtDq02': '2',
        'm2vAtDq03': '2',
        'm2vAtDq04': '2',
        'm2vAtDq05': '1',
        'm2vAtDq06': '1',
        'm2vAtDq07': '1',
        'm2vAtDq08': '2',
        'm2vAtDq09': '1',
        'm2vAtDq10': '1'
    },
    'm2vAtE': {
        'm2vAtEq01': '2',
        'm2vAtEq02': '1',
        'm2vAtEq03': '5',
        'm2vAtEq04': '3',
        'm2vAtEq05': '4'
    },
    'm2vAtF': {
        'm2vAtFq01': '2',
        'm2vAtFq02': '3',
        'm2vAtFq03': '2',
        'm2vAtFq04': '1',
        'm2vAtFq05': '1',
        'm2vAtFq06': '2',
        'm2vAtFq07': '3',
        'm2vAtFq08': '3',
        'm2vAtFq09': '2',
        'm2vAtFq10': '1'
    },
    'm2vAtH': {
        'm2vAtHq01': '4',
        'm2vAtHq02': '2',
        'm2vAtHq03': '6',
        'm2vAtHq04': '1',
        'm2vAtHq05': '5'
    },
    'm2vBtA' : {
        'm2vBtAq01': '1',
        'm2vBtAq02': '1',
        'm2vBtAq03': '2',
        'm2vBtAq04': '2',
        'm2vBtAq05': '2',
        'm2vBtAq06': '1',
        'm2vBtAq07': '1',
        'm2vBtAq08': '2',
        'm2vBtAq09': '2',
        'm2vBtAq10': '2'
    },
    'm2vBtB' : {
        'm2vBtBq01': '3',
        'm2vBtBq02': '7',
        'm2vBtBq03': '1',
        'm2vBtBq04': '2',
        'm2vBtBq05': '6'
    },
    'm2vBtC' : {
        'm2vBtCq01': 'has been working',
        'm2vBtCq02': 'have you ever eaten',
        'm2vBtCq03': 'has gone',
        'm2vBtCq04': 'have you been cleaning',
        'm2vBtCq05': 'havent bought',
    },
    'm2vBtD': {
        'm2vAtDq01': '1',
        'm2vAtDq02': '1',
        'm2vAtDq03': '1',
        'm2vAtDq04': '2',
        'm2vAtDq05': '1',
        'm2vAtDq06': '2',
        'm2vAtDq07': '1',
        'm2vAtDq08': '2',
        'm2vAtDq09': '2',
        'm2vAtDq10': '1'
    },
    'm2vBtE': {
        'm2vAtEq01': '2',
        'm2vAtEq02': '1',
        'm2vAtEq03': '5',
        'm2vAtEq04': '3',
        'm2vAtEq05': '4'
    },
    'm2vBtF': {
        'm2vBtFq01': '2',
        'm2vBtFq02': '3',
        'm2vBtFq03': '2',
        'm2vBtFq04': '1',
        'm2vBtFq05': '1',
        'm2vBtFq06': '2',
        'm2vBtFq07': '3',
        'm2vBtFq08': '3',
        'm2vBtFq09': '2',
        'm2vBtFq10': '1'
    },
    'm2vBtH': {
        'm2vBtHq01': '4',
        'm2vBtHq02': '2',
        'm2vBtHq03': '6',
        'm2vBtHq04': '1',
        'm2vBtHq05': '5'
    }
}
function getAnswers(testId) {
    return answers[testId];
}

function init() {
    for (testId in answers) {
        let status = getCookie(testId);
        let button = document.getElementById(testId+"button");
        if (!button) continue;
        if (status) {
            if (status == "pаssеd") {
                button.style.backgroundColor = "lightgreen";
            } else {
                button.style.backgroundColor = "lightpink";
            }
        }
    }
}
function goHome() {
    pauseAudio();
    hideAll();
    document.getElementById('homeScreen').style.display = 'block';
}
function hideAll() {
    var els = document.getElementsByClassName('screen');
    Array.prototype.forEach.call(els, function(el) {
        el.style.display = 'none';
    });
}
function test(testId) {
    hideAll();
    if (document.getElementById(testId)) {
        document.getElementById(testId).style.display = 'block';

        var els = document.getElementsByTagName('select');
        Array.prototype.forEach.call(els, function (el) {
            el.style.backgroundColor = '';
        });
    } else {
        loadAndStartTest(testId);
    }
}
function loadAndStartTest(testId) {
    fetch('tests/'+testId+'.html')
        .then(resp => resp.text())
        .then(text => {
            let testDiv = document.createElement('div');
            testDiv.innerHTML = text;
            document.body.append(testDiv.firstChild);
            test(testId);
        });
}

function check(testId) {
    pauseAudio();
    var correctAnswersCount = 0;
    var answers = getAnswers(testId);
    var questionsCount = 0;
    for (var key in answers) {
        questionsCount++;
        if (normalizeText(document.getElementById(key).value) === answers[key]) {
                correctAnswersCount++;
        } else {
            document.getElementById(key).style.backgroundColor = 'lightpink';
        }
    }


    if (correctAnswersCount === questionsCount) {
        // alert("Congratulations! All right!");
        document.getElementById("completedTestId").innerText = testId;
        document.getElementById("testPassedMessage").style.visibility="visible";
        document.getElementById(testId+"button").style.backgroundColor = "lightgreen";
        setCookie(testId, "pаssеd");
    } else {
        // alert("Test failed. Right answers " + correctAnswersCount + "/" + questionsCount);
        document.getElementById("failedTestResult").innerText = "Test " + testId + " failed. (" + correctAnswersCount + "/" + questionsCount + ")";
        document.getElementById("testFailedMessage").style.visibility="visible";
        document.getElementById(testId+"button").style.backgroundColor = "lightpink";
        setCookie(testId, "failed");
    }
}

function normalizeText(text) {
    return text.trim().toLowerCase().replace("'",'');
}

function hideMe(element) {
    if(element) {
        element.style.visibility = "hidden";
    }
}

function pauseAudio() {
    var audios = document.getElementsByTagName('audio');
    Array.prototype.forEach.call(audios, function (el) {
        el.pause();
    });
}